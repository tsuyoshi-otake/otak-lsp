# 実装計画

- [x] 1. AdvancedRulesManagerの修正
  - `server/src/grammar/advancedRulesManager.ts`の`fixDiagnosticRange`メソッドを改善
  - 判定ロジックを改善: line:0 かつ character が最初の行の長さを超えている場合のみオフセットベースと判断
  - 要件 1.2: 既に正しい範囲を持っている場合は変更しない
  - 要件 1.3: オフセットベースの場合は行/文字ベースに変換する
  - _要件: 1.1, 1.2, 1.3, 2.2_

- [x] 1.1 単体テストの作成
  - `AdvancedRulesManager`の修正が正しいことを確認する単体テストを作成
  - 診断の範囲が正しく処理されることを確認（要件 1.2, 1.3）
  - 複数の診断が正しい範囲で生成されることを確認
  - 境界値テスト（最初の行の長さちょうど、+1）
  - _要件: 3.1, 3.3_

- [x] 1.2 プロパティベーステストの作成
  - **プロパティ 1: 行番号0以外の範囲は保持される**
  - **プロパティ 2: 行0で最初の行内の範囲は保持される**
  - **プロパティ 3: オフセットベースの範囲は変換される**
  - **プロパティ 4: 範囲の有効性**
  - **検証: 要件 1.2, 1.3**
  - _要件: 3.2_

- [x] 2. 統合テストの実行
  - 既存の統合テスト（markdownGrammar.integration.test.ts）で位置精度を確認
  - 「食べれる」が行4に正しく検出されることを確認
  - 複数のルールが有効な場合、各診断が正しい範囲で生成されることを確認
  - _要件: 1.4_

- [x] 3. チェックポイント - すべてのテストが合格することを確認
  - すべてのテスト（1304件）が合格
  - スナップショットテストを更新（改善された行番号計算の反映）
