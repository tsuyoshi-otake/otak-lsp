# 要件ドキュメント

## はじめに

日本語の文章において、文末にコロン（：）を使用することは文法的に不適切です。コロンは主に箇条書きの前置きや、説明を導入する際に使用されますが、文の終わりには使用しません。この機能は、日本語文の末尾に全角コロン（：）が使われている場合に警告を表示し、適切な句読点への修正を提案します。

## 用語集

- **文末**: 文の終わりを示す位置。通常は句点（。）、疑問符（？）、感嘆符（！）で終わる
- **コロン**: 全角の「：」記号。半角の「:」は対象外
- **句読点**: 文の区切りや終わりを示す記号（。、？、！など）
- **システム**: otak-lcp拡張機能の文法チェック機能

## 要件

### 要件 1

**ユーザーストーリー**: ユーザーとして、日本語文の末尾に不適切なコロンが使用されている場合に警告を受け取りたい。これにより、文法的に正しい日本語文書を作成できる。

#### 受入基準

1. WHEN 日本語文の末尾に全角コロン（：）が検出された場合 THEN システムは警告診断を生成しなければならない
2. WHEN 文末コロンが検出された場合 THEN システムは適切な句読点（。）への修正を提案しなければならない
3. WHEN コロンが文中に使用されている場合 THEN システムは警告を生成してはならない
4. WHEN コロンが箇条書きの前置き文に使用されている場合 THEN システムは警告を生成してはならない
5. WHEN 半角コロン（:）が使用されている場合 THEN システムは警告を生成してはならない

### 要件 2

**ユーザーストーリー**: ユーザーとして、文末コロンの検出ルールを有効化または無効化したい。これにより、プロジェクトの文書スタイルに応じて柔軟に対応できる。

#### 受入基準

1. WHEN ユーザーが設定で文末コロン検出を有効化した場合 THEN システムは文末コロンを検出しなければならない
2. WHEN ユーザーが設定で文末コロン検出を無効化した場合 THEN システムは文末コロンを検出してはならない
3. WHEN 設定が指定されていない場合 THEN システムはデフォルトで文末コロン検出を有効にしなければならない

### 要件 3

**ユーザーストーリー**: ユーザーとして、文末コロンの警告メッセージが明確で理解しやすいものであってほしい。これにより、問題を素早く理解し修正できる。

#### 受入基準

1. WHEN 文末コロンが検出された場合 THEN システムは「文末にコロン（：）が使用されています」というメッセージを表示しなければならない
2. WHEN 警告が表示される場合 THEN システムは「句点（。）に変更するか、文を続けてください」という修正提案を含めなければならない
3. WHEN 診断が生成される場合 THEN システムは警告レベル（Warning）の診断を生成しなければならない

### 要件 4

**ユーザーストーリー**: 開発者として、文末コロン検出ルールが他の高度な文法ルールと統合されていてほしい。これにより、一貫したアーキテクチャを維持できる。

#### 受入基準

1. WHEN 文末コロン検出ルールが実装される場合 THEN システムは`AdvancedGrammarRule`インターフェースを実装しなければならない
2. WHEN ルールが実行される場合 THEN システムは`RuleContext`（全文テキスト、文分割結果、設定）を受け取らなければならない
3. WHEN ルールが実行される場合 THEN システムは`AdvancedDiagnostic`配列を返さなければならない
4. WHEN ルールが登録される場合 THEN システムは`AdvancedRulesManager`に登録されなければならない

### 要件 5

**ユーザーストーリー**: 開発者として、文末コロン検出ルールの正確性が検証されていてほしい。これにより、誤検出や見逃しを防ぐことができる。

#### 受入基準

1. WHEN ルールがテストされる場合 THEN システムはユニットテストで基本的な検出パターンを検証しなければならない
2. WHEN ルールがテストされる場合 THEN システムはプロパティベーステストで様々な入力パターンを検証しなければならない
3. WHEN テストが実行される場合 THEN システムは文末コロンの検出精度が100%であることを確認しなければならない
4. WHEN テストが実行される場合 THEN システムは誤検出（false positive）がないことを確認しなければならない
