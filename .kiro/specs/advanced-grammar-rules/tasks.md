# 実装計画

## 既存の実装について

既存のシステムには以下が実装済みです：
- `GrammarChecker`クラス（`server/src/grammar/checker.ts`）
- `GrammarRule`インターフェース
- 基本的な文法ルール（二重助詞、助詞連続、動詞-助詞不整合、冗長な助動詞）
- `Token`、`GrammarError`、`Diagnostic`などのコア型定義（`shared/src/types.ts`）

新しい高度な文法ルールは、既存の`GrammarRule`インターフェースを実装する形で追加します。

## タスク

- [ ] 1. 高度な文法ルール用の型定義の追加
  - `GrammarErrorType`に新しいエラータイプを追加（`shared/src/types.ts`）
  - Sentence、StyleInconsistency等の新しいデータモデルを追加
  - 高度なルール用の設定型を定義
  - _要件: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1, 7.1, 8.1, 9.1, 10.1, 11.1_

- [ ] 2. 文解析ユーティリティの実装
  - テキストを文に分割する機能を実装（`server/src/grammar/sentenceParser.ts`）
  - 句点による文の区切りを認識
  - 各文のトークンリストを生成
  - 読点のカウント機能を実装
  - _要件: 1.1, 9.4_

- [ ] 2.1 ユニットテスト: 文解析ユーティリティ
  - 文の分割を検証
  - 読点のカウントを検証
  - エッジケース（空文字列、句点のみ）を検証
  - _要件: 1.1, 9.4_

- [ ] 3. Style Consistency Ruleの実装
  - `StyleConsistencyRule`クラスを作成（`server/src/grammar/rules/styleConsistencyRule.ts`）
  - `GrammarRule`インターフェースを実装
  - 文末パターンによる文体認識を実装（「です」「ます」→敬体、「である」→常体）
  - 「だ」などその他の文末は中立として扱う
  - 文書内の文体混在を検出
  - 診断情報と文体統一の提案を生成
  - 既存の`GrammarChecker`に登録
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 3.1 プロパティテスト: 文体認識の正確性
  - **プロパティ 1: 文体認識の正確性**
  - **検証: 要件 1.1, 1.2, 1.5**

- [ ] 3.2 プロパティテスト: 文体混在の検出
  - **プロパティ 2: 文体混在の検出**
  - **検証: 要件 1.3, 1.4**

- [ ] 3.3 ユニットテスト: Style Consistency Rule
  - 「です」「ます」の敬体認識を検証
  - 「である」の常体認識を検証
  - 「だ」が中立として扱われることを検証
  - 文体混在の検出を検証
  - _要件: 1.1, 1.2, 1.3, 1.5_

- [ ] 4. Ra-nuki Detection Ruleの実装
  - `RaNukiRule`クラスを作成（`server/src/grammar/rules/raNukiRule.ts`）
  - `GrammarRule`インターフェースを実装
  - 動詞の活用タイプ判定を実装（五段活用、一段活用）
  - 「れる」接続のら抜き言葉を検出
  - 正しい「られる」形への修正候補を生成
  - 診断情報を生成
  - 既存の`GrammarChecker`に登録
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 5.1 プロパティテスト: ら抜き言葉の検出と提案
  - **プロパティ 3: ら抜き言葉の検出と提案**
  - **検証: 要件 2.1, 2.2, 2.3, 2.4, 2.5**

- [ ] 5.2 ユニットテスト: Ra-nuki Detection Rule
  - 「食べれる」→「食べられる」の検出を検証
  - 「見れる」→「見られる」の検出を検証
  - 正しい「られる」形でエラーが出ないことを検証
  - _要件: 2.1, 2.2, 2.5_

- [ ] 6. Double Negation Ruleの実装
  - 二重否定パターンを定義（「ないわけではない」「ないことはない」など）
  - 二重否定を検出
  - 肯定表現への書き換え提案を生成
  - 診断情報を生成
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 6.1 プロパティテスト: 二重否定の検出と提案
  - **プロパティ 4: 二重否定の検出と提案**
  - **検証: 要件 3.1, 3.2, 3.3, 3.5**

- [ ] 6.2 ユニットテスト: Double Negation Rule
  - 「ないわけではない」の検出を検証
  - 「ないことはない」の検出を検証
  - 単一否定でエラーが出ないことを検証
  - _要件: 3.4, 3.5_

- [ ] 7. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [ ] 8. Particle Repetition Ruleの実装
  - 同じ助詞の連続使用を検出
  - 設定による有効/無効の制御を実装
  - 文の書き換え提案を生成
  - 診断情報を生成
  - _要件: 4.1, 4.3, 4.4, 4.5_

- [ ] 8.1 プロパティテスト: 助詞連続使用の設定依存検出
  - **プロパティ 5: 助詞連続使用の設定依存検出**
  - **検証: 要件 4.1, 4.3, 4.4**

- [ ] 8.2 ユニットテスト: Particle Repetition Rule
  - 同じ助詞の連続使用検出を検証
  - 設定による無効化を検証
  - デフォルト設定で無効であることを検証
  - _要件: 4.1, 4.3, 4.5_

- [ ] 9. Conjunction Repetition Ruleの実装
  - 一般的な接続詞リストを定義（「しかし」「また」「そして」など）
  - 同じ接続詞の連続使用を検出
  - 代替の接続詞を提案
  - 1文おきの使用は検出しない
  - 診断情報を生成
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 9.1 プロパティテスト: 接続詞連続使用の検出と代替案
  - **プロパティ 6: 接続詞連続使用の検出と代替案**
  - **検証: 要件 5.1, 5.2, 5.4, 5.5**

- [ ] 9.2 ユニットテスト: Conjunction Repetition Rule
  - 「しかし」の連続使用検出を検証
  - 代替接続詞の提案を検証
  - 1文おきの使用で検出されないことを検証
  - _要件: 5.3, 5.5_

- [ ] 10. Adversative Ga Ruleの実装
  - 逆接の「が」と格助詞の「が」を区別
  - 逆接の「が」の連続使用を検出
  - 文の分割や接続詞の変更を提案
  - 1文おきの使用は検出しない
  - 診断情報を生成
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 10.1 プロパティテスト: 逆接「が」の連続使用検出
  - **プロパティ 7: 逆接「が」の連続使用検出**
  - **検証: 要件 6.1, 6.2, 6.3, 6.4, 6.5**

- [ ] 10.2 ユニットテスト: Adversative Ga Rule
  - 逆接の「が」の検出を検証
  - 格助詞の「が」が検出されないことを検証
  - 1文おきの使用で検出されないことを検証
  - _要件: 6.3, 6.4_

- [ ] 11. Alphabet Width Ruleの実装
  - 全角アルファベットと半角アルファベットを検出
  - 文書内の混在を検出
  - 半角への変換提案を生成
  - 統一されている場合は検出しない
  - 診断情報を生成
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 11.1 プロパティテスト: 全角半角混在の検出と提案
  - **プロパティ 8: 全角半角混在の検出と提案**
  - **検証: 要件 7.1, 7.2, 7.3, 7.4, 7.5**

- [ ] 11.2 ユニットテスト: Alphabet Width Rule
  - 全角と半角の混在検出を検証
  - 半角のみで検出されないことを検証
  - 全角のみで検出されないことを検証
  - _要件: 7.3, 7.4_

- [ ] 12. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [ ] 13. Weak Expression Ruleの実装
  - 弱い表現パターンを定義（「かもしれない」「と思われる」「ような気がする」など）
  - 弱い表現を検出
  - より断定的な表現を提案
  - 診断情報を生成
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 13.1 プロパティテスト: 弱い表現の検出と強化提案
  - **プロパティ 9: 弱い表現の検出と強化提案**
  - **検証: 要件 8.4, 8.5**

- [ ] 13.2 ユニットテスト: Weak Expression Rule
  - 「かもしれない」の検出を検証
  - 「と思われる」の検出を検証
  - 「ような気がする」の検出を検証
  - 断定的な表現の提案を検証
  - _要件: 8.1, 8.2, 8.3_

- [ ] 14. Comma Count Ruleの実装
  - 1文中の読点をカウント
  - 閾値（デフォルト4個）を超える場合に検出
  - 文の分割を提案
  - 診断情報に読点の数を含める
  - _要件: 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ] 14.1 プロパティテスト: 読点数の閾値チェック
  - **プロパティ 10: 読点数の閾値チェック**
  - **検証: 要件 9.1, 9.2, 9.3, 9.4, 9.5**

- [ ] 14.2 ユニットテスト: Comma Count Rule
  - 5個以上の読点の検出を検証
  - 4個以下で検出されないことを検証
  - 診断情報に読点の数が含まれることを検証
  - _要件: 9.1, 9.3, 9.5_

- [ ] 15. Term Notation Ruleの実装
  - `TermNotationRule`クラスを作成（`server/src/grammar/rules/termNotationRule.ts`）
  - `GrammarRule`インターフェースを実装
  - 基本的なウェブ技術用語の表記ルールを定義（Javascript→JavaScript、Github→GitHub等）
  - 生成AI関連用語の表記ルールを定義（chatgpt→ChatGPT、openai→OpenAI等）
  - AWS関連用語の表記ルールを定義（aws→AWS、ec2→EC2、s3→S3等）
  - Azure関連用語の表記ルールを定義（azure→Azure、cosmos db→Cosmos DB等）
  - OCI関連用語の表記ルールを定義（oci→OCI、oracle cloud→Oracle Cloud等）
  - 設定に基づいて有効な辞書を選択する機能を実装
  - 誤った表記を検出
  - 正しい表記への修正を提案
  - カスタムルールの追加機能を実装
  - 診断情報を生成
  - 既存の`GrammarChecker`に登録
  - _要件: 10.1, 10.2, 10.3, 10.4, 10.5, 12.1, 12.2, 12.3, 12.4, 12.5, 13.4_

- [ ] 15.1 プロパティテスト: 技術用語表記の統一
  - **プロパティ 11: 技術用語表記の統一**
  - **検証: 要件 10.5, 12.1, 12.2, 12.3, 12.4, 12.5**

- [ ] 15.2 ユニットテスト: Term Notation Rule
  - ウェブ技術用語の検出を検証（「Javascript」→「JavaScript」等）
  - 生成AI用語の検出を検証（「chatgpt」→「ChatGPT」、「openai」→「OpenAI」等）
  - AWS用語の検出を検証（「aws」→「AWS」、「lambda」→「Lambda」等）
  - Azure用語の検出を検証（「azure」→「Azure」、「cosmos db」→「Cosmos DB」等）
  - OCI用語の検出を検証（「oci」→「OCI」等）
  - 辞書の有効/無効設定を検証
  - カスタムルールの追加を検証
  - _要件: 10.1, 10.2, 10.3, 10.4, 12.1, 12.2, 12.3, 12.4, 13.4_

- [ ] 16. Kanji Opening Ruleの実装
  - 漢字開きルールを定義（下さい→ください、出来る→できる等）
  - 開くべき漢字を検出
  - ひらがな表記への修正を提案
  - 診断情報を生成
  - _要件: 11.1, 11.2, 11.3, 11.4, 11.5_

- [ ] 16.1 プロパティテスト: 漢字開きの統一
  - **プロパティ 12: 漢字開きの統一**
  - **検証: 要件 11.5**

- [ ] 16.2 ユニットテスト: Kanji Opening Rule
  - 「下さい」→「ください」の検出を検証
  - 「出来る」→「できる」の検出を検証
  - 「有難う」→「ありがとう」の検出を検証
  - 「宜しく」→「よろしく」の検出を検証
  - _要件: 11.1, 11.2, 11.3, 11.4_

- [ ] 17. Advanced Rules Configの実装
  - 設定インターフェースを定義（`shared/src/types.ts`に追加）
  - デフォルト設定値を定義（助詞連続チェックは初期無効）
  - 各ルールの有効/無効設定を実装
  - 技術用語辞典の有効/無効設定を実装（ウェブ技術、生成AI、AWS、Azure、OCI）
  - 読点の閾値設定を実装
  - 弱い表現の検出レベル設定を実装
  - カスタム表記統一ルールの設定を実装
  - _要件: 13.1, 13.2, 13.3, 13.4, 13.5_

- [ ] 17.1 プロパティテスト: 設定変更の即時反映
  - **プロパティ 13: 設定変更の即時反映**
  - **検証: 要件 13.5**

- [ ] 17.2 ユニットテスト: Advanced Rules Config
  - デフォルト設定値を検証
  - 助詞連続チェックが初期無効であることを検証
  - 技術用語辞典がすべて初期有効であることを検証
  - 設定の読み書きを検証
  - _要件: 4.5, 13.1, 13.2, 13.3_

- [ ] 18. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [ ] 19. 既存Grammar Checkerとの統合
  - Advanced Rules Managerを既存のGrammar Checkerに統合
  - 基本ルールと高度なルールの診断情報をマージ
  - 設定による高度なルールの有効/無効を実装
  - _要件: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1, 7.1, 8.1, 9.1, 10.1, 11.1_

- [ ] 19.1 統合テスト: Grammar Checkerとの統合
  - 基本ルールと高度なルールが両方実行されることを検証
  - 診断情報のマージを検証
  - 設定による制御を検証
  - _要件: 12.5_

- [ ] 20. VSCode設定項目の追加
  - package.jsonに高度な文法ルールの設定項目を追加
  - 各ルールの有効/無効設定を追加
  - 技術用語辞典の有効/無効設定を追加（ウェブ技術、生成AI、AWS、Azure、OCI）
  - 読点の閾値設定を追加
  - 弱い表現の検出レベル設定を追加
  - カスタム表記統一ルールの設定を追加
  - _要件: 13.1, 13.2, 13.3, 13.4_

- [ ] 21. READMEの更新
  - 高度な文法ルールの機能説明を追加
  - 各ルールの説明と例を記述
  - 技術用語辞典の説明を追加（生成AI、AWS、Azure、OCI）
  - サポートされている技術用語のリストを記述
  - 設定項目の説明を追加
  - 使用例とスクリーンショットを追加
  - _要件: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1, 7.1, 8.1, 9.1, 10.1, 11.1, 12.1, 12.2, 12.3, 12.4, 12.5, 13.1_

- [ ] 22. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する
