# 要件ドキュメント

## はじめに

otak-lcpは日本語形態素解析VSCode拡張機能で、Markdownファイル内の日本語テキストに対してセマンティックハイライト機能を提供しています。現在、Markdownテーブル内のテキストは文法チェックの誤検出を防ぐために完全に除外されていますが、これによりテーブル内の日本語テキストがセマンティックハイライトされない問題があります。テーブル内の日本語テキストもセマンティックハイライトの対象とすることで、文書全体の可読性を向上させます。

## 用語集

- **System**: otak-lcp Language Server
- **Semantic Token**: 品詞情報に基づいて色分けされるトークン
- **Markdown Filter**: Markdownドキュメントからコードブロック、テーブル、URLなどを除外するコンポーネント
- **Grammar Checker**: 日本語文法をチェックするシステム
- **Table Cell**: Markdownテーブルの個別セル
- **Table Delimiter**: テーブルの区切り文字（|）
- **Separator Row**: テーブルのヘッダーとボディを区切る行（例: |---|---|）

## 要件

### 要件 1

**ユーザーストーリー:** 開発者として、Markdownテーブル内の日本語テキストが品詞に応じて色分けされることを期待します。これにより、テーブル内の文書の可読性が向上します。

#### 受入基準

1. WHEN System がMarkdownドキュメントを解析するとき、THEN System はテーブル内の日本語テキストに対してセマンティックトークンを生成しなければならない
2. WHEN System がテーブル内のテキストを処理するとき、THEN System はテーブル区切り文字（|）を除外しなければならない
3. WHEN System がテーブル内のテキストを処理するとき、THEN System はセパレーター行（|---|---|）を除外しなければならない
4. WHEN System がテーブル内のテキストを処理するとき、THEN System は各セル内の日本語テキストをセマンティックハイライトの対象としなければならない

### 要件 2

**ユーザーストーリー:** 開発者として、テーブル内の技術的要素（コード、URL、設定キー）はセマンティックハイライトの対象外であることを期待します。これにより、技術的要素と通常のテキストの区別が明確になります。

#### 受入基準

1. WHEN System がテーブルセル内のインラインコードを検出するとき、THEN System はそのコードをセマンティックハイライトの対象から除外しなければならない
2. WHEN System がテーブルセル内のURLを検出するとき、THEN System はそのURLをセマンティックハイライトの対象から除外しなければならない
3. WHEN System がテーブルセル内の設定キーを検出するとき、THEN System はその設定キーをセマンティックハイライトの対象から除外しなければならない
4. WHEN System がテーブルセル内の除外対象要素を処理するとき、THEN System はセル内の他の日本語テキストをセマンティックハイライトの対象としなければならない

### 要件 3

**ユーザーストーリー:** 開発者として、テーブル内のテキストが文法チェックの対象外であることを期待します。これにより、テーブル構造による誤った文法警告を回避できます。

#### 受入基準

1. WHEN Grammar Checker がMarkdownドキュメントを解析するとき、THEN Grammar Checker はテーブル全体を文法チェック対象から除外しなければならない
2. WHEN Grammar Checker がテーブル内のテキストを処理するとき、THEN Grammar Checker はテーブル区切り文字を読点としてカウントしてはならない
3. WHEN Grammar Checker がテーブル全体を処理するとき、THEN Grammar Checker はテーブル全体を単一の文として扱ってはならない
4. WHEN Grammar Checker がテーブルセルを処理するとき、THEN Grammar Checker は各セルを独立した文として扱ってはならない

### 要件 4

**ユーザーストーリー:** システム管理者として、テーブル内のセマンティックハイライトを設定で制御できることを期待します。これにより、プロジェクトの特性に応じて動作をカスタマイズできます。

#### 受入基準

1. WHEN テーブル内セマンティックハイライト設定が有効なとき、THEN System はテーブル内の日本語テキストをセマンティックハイライトの対象としなければならない
2. WHEN テーブル内セマンティックハイライト設定が無効なとき、THEN System はテーブル全体をセマンティックハイライトの対象から除外しなければならない
3. WHEN 設定が変更されるとき、THEN System は新しい設定に基づいてセマンティックハイライト動作を更新しなければならない
4. WHEN 設定が無効または不正なとき、THEN System はデフォルト設定（テーブル内セマンティックハイライト有効）で動作しなければならない

### 要件 5

**ユーザーストーリー:** 開発者として、テーブル内のセマンティックハイライトが正しく動作することを検証できることを期待します。これにより、実装の正確性を確認できます。

#### 受入基準

1. WHEN System がテーブルを処理するとき、THEN System はテーブル区切り文字とセパレーター行の除外範囲情報を提供しなければならない
2. WHEN System がテーブルセル内の除外要素を処理するとき、THEN System は各除外要素の範囲情報を提供しなければならない
3. WHEN デバッグモードが有効なとき、THEN System はテーブル処理の詳細ログを出力しなければならない
4. WHEN テーブル処理でエラーが発生するとき、THEN System はエラー内容と発生箇所を詳細に報告しなければならない
