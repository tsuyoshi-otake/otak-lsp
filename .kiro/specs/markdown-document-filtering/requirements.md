# 要件文書

## 概要

日本語文法チェッカーがマークダウン文書を解析する際に、コードブロック、テーブル、URL内のテキストなどの技術的要素を適切に除外し、誤検出を防ぐマークダウン文書フィルタリング機能を実装する。

## 用語集

- **Grammar_Checker**: 日本語文法をチェックするシステム
- **Markdown_Filter**: マークダウン構造を認識してテキストをフィルタリングするコンポーネント
- **Code_Block**: ```で囲まれたコードブロック
- **Table_Cell**: マークダウンテーブルの個別セル
- **URL_Content**: URLに含まれるテキスト内容
- **Configuration_Key**: otakLcp.*のような設定キー名

## 要件

### 要件 1

**ユーザーストーリー:** 技術文書の作成者として、コードブロック内のコードが日本語文法チェックの対象外になることを望む。そうすることで、プログラミングコードに対する誤った文法警告を回避できる。

#### 受入基準

1. WHEN マークダウン文書にコードブロックが含まれる場合、THEN Grammar_Checker SHALL コードブロック内のテキストを文法チェック対象から除外する
2. WHEN インラインコード（`で囲まれた部分）が含まれる場合、THEN Grammar_Checker SHALL インラインコード内のテキストを文法チェック対象から除外する
3. WHEN コードブロックが複数行にわたる場合、THEN Grammar_Checker SHALL 開始マーカーから終了マーカーまでの全内容を除外する
4. WHEN ネストしたコードブロックが存在する場合、THEN Grammar_Checker SHALL 最外層のマーカーに基づいて適切に除外する

### 要件 2

**ユーザーストーリー:** 技術文書の作成者として、マークダウンテーブル内の設定キーや技術用語が文法チェックの対象外になることを望む。そうすることで、テーブル構造による誤った長文警告や名詞連続警告を回避できる。

#### 受入基準

1. WHEN マークダウンテーブルが文書に含まれる場合、THEN Grammar_Checker SHALL 各テーブルセルを独立した文として扱う
2. WHEN テーブルセルに設定キー名が含まれる場合、THEN Grammar_Checker SHALL 設定キー名を文法チェック対象から除外する
3. WHEN テーブル区切り文字（|）が含まれる場合、THEN Grammar_Checker SHALL 区切り文字を読点としてカウントしない
4. WHEN テーブル全体が長い場合、THEN Grammar_Checker SHALL テーブル全体を単一の文として扱わない

### 要件 3

**ユーザーストーリー:** 技術文書の作成者として、URL内のテキストが文法チェックの対象外になることを望む。そうすることで、URLに含まれる英語やドメイン名による誤った警告を回避できる。

#### 受入基準

1. WHEN 文書にURLが含まれる場合、THEN Grammar_Checker SHALL URL内のテキストを文法チェック対象から除外する
2. WHEN マークダウンリンク記法 [text](url) が使用される場合、THEN Grammar_Checker SHALL URL部分のみを除外し、リンクテキストは文法チェック対象とする
3. WHEN 自動リンク記法 <url> が使用される場合、THEN Grammar_Checker SHALL URL全体を文法チェック対象から除外する
4. WHEN プレーンテキストURLが含まれる場合、THEN Grammar_Checker SHALL URLパターンを認識して除外する

### 要件 4

**ユーザーストーリー:** システム管理者として、マークダウンフィルタリング機能の動作を設定できることを望む。そうすることで、プロジェクトの特性に応じてフィルタリング動作をカスタマイズできる。

#### 受入基準

1. WHEN フィルタリング設定が変更される場合、THEN Grammar_Checker SHALL 新しい設定に基づいてフィルタリング動作を更新する
2. WHEN 特定のパターンを除外リストに追加する場合、THEN Grammar_Checker SHALL そのパターンにマッチするテキストを文法チェック対象から除外する
3. WHEN フィルタリング機能を無効化する場合、THEN Grammar_Checker SHALL 全てのテキストを文法チェック対象として扱う
4. WHEN 設定が無効または不正な場合、THEN Grammar_Checker SHALL デフォルト設定でフィルタリングを実行する

### 要件 5

**ユーザーストーリー:** 開発者として、フィルタリング処理の結果を検証できることを望む。そうすることで、フィルタリングが正しく動作していることを確認し、デバッグを効率的に行える。

#### 受入基準

1. WHEN フィルタリング処理が実行される場合、THEN Markdown_Filter SHALL 除外されたテキスト範囲の情報を提供する
2. WHEN デバッグモードが有効な場合、THEN Markdown_Filter SHALL フィルタリング処理の詳細ログを出力する
3. WHEN フィルタリング前後のテキストを比較する場合、THEN Markdown_Filter SHALL 変更箇所を明確に示す
4. WHEN フィルタリング処理でエラーが発生する場合、THEN Markdown_Filter SHALL エラー内容と発生箇所を詳細に報告する