# 実装計画

- [x] 1. プロジェクト構造とコア型定義のセットアップ
  - VSCode拡張のディレクトリ構造を作成（client/server分離）
  - TypeScript設定ファイルを作成
  - package.jsonを作成し、必要な依存関係を定義
  - Token、DocumentAnalysis、GrammarErrorなどのコア型定義を作成
  - _要件: 1.1, 1.2, 1.3_

- [x] 2. MeCab Analyzerの実装
  - MeCabプロセスとの通信を管理するクラスを実装
  - MeCabの出力をパースしてTokenオブジェクトに変換する機能を実装
  - MeCabの存在確認とバージョン取得機能を実装
  - _要件: 1.1, 1.2, 1.3, 8.1, 8.4_

- [x] 2.1 プロパティテスト: トークン化の完全性
  - **プロパティ 1: トークン化の完全性**
  - **検証: 要件 1.1**

- [x] 2.2 プロパティテスト: トークン情報の完全性
  - **プロパティ 2: トークン情報の完全性**
  - **検証: 要件 1.2, 1.3**

- [x] 2.3 ユニットテスト: MeCab Analyzer
  - 特定の日本語テキストの解析結果を検証
  - 空文字列や特殊文字の処理を検証
  - MeCabが利用できない場合のエラーハンドリングを検証
  - _要件: 1.1, 1.2, 1.3, 1.5_

- [x] 3. Comment Extractorの実装
  - C/C++/Javaのコメント抽出機能を実装（`//` および `/* */`）
  - Pythonのコメント抽出機能を実装（`#` および `"""`）
  - JavaScript/TypeScriptのコメント抽出機能を実装（`//` および `/* */`）
  - Rustのコメント抽出機能を実装（`//` および `/* */`）
  - Markdownのテキスト抽出機能を実装（ファイル全体を対象）
  - 言語IDに基づいて適切な抽出ロジックを選択する機能を実装
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 3.1 プロパティテスト: コメント抽出の正確性
  - **プロパティ 4: コメント抽出の正確性**
  - **検証: 要件 2.1, 2.2, 2.3, 2.4, 2.5**

- [x] 3.2 ユニットテスト: Comment Extractor
  - 各言語の行コメントとブロックコメントの抽出を検証
  - Markdownファイル全体の抽出を検証
  - ネストされたコメントや文字列内のコメント風テキストの処理を検証
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 4. Grammar Checkerの実装
  - 二重助詞検出ルールを実装
  - 助詞連続検出ルールを実装
  - 動詞-助詞不整合検出ルールを実装
  - 診断情報生成機能を実装（エラーメッセージ、範囲、修正候補）
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 4.1 プロパティテスト: 二重助詞の検出
  - **プロパティ 5: 二重助詞の検出**
  - **検証: 要件 3.1**

- [x] 4.2 プロパティテスト: 助詞連続の検出
  - **プロパティ 6: 助詞連続の検出**
  - **検証: 要件 3.2**

- [x] 4.3 プロパティテスト: 動詞-助詞不整合の検出
  - **プロパティ 7: 動詞-助詞不整合の検出**
  - **検証: 要件 3.3**

- [x] 4.4 プロパティテスト: 診断情報の完全性
  - **プロパティ 8: 診断情報の完全性**
  - **検証: 要件 3.4, 3.5**

- [x] 4.5 ユニットテスト: Grammar Checker
  - 既知の文法エラーパターン（「がが」「をを」など）を検証
  - 正しい文法のテキストでエラーが出ないことを検証
  - _要件: 3.1, 3.2, 3.3_

- [x] 5. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 6. Semantic Token Providerの実装
  - 品詞からセマンティックトークンタイプへのマッピングを実装
  - LSPのセマンティックトークン形式でデータを生成する機能を実装
  - 名詞、動詞、形容詞、助詞、副詞のトークンタイプを定義
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 6.1 プロパティテスト: セマンティックトークンの生成
  - **プロパティ 9: セマンティックトークンの生成**
  - **検証: 要件 4.1, 4.2, 4.3, 4.4**

- [x] 6.2 ユニットテスト: Semantic Token Provider
  - 各品詞が正しいトークンタイプにマッピングされることを検証
  - セマンティックトークンデータの形式が正しいことを検証
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [x] 7. Wikipedia API Clientの実装
  - Wikipedia APIへのHTTPリクエストを実装
  - サマリー取得機能を実装
  - エラーハンドリング（タイムアウト、レート制限、接続失敗）を実装
  - キャッシング機能を実装（LRUキャッシュ、TTL: 24時間）
  - _要件: 5.4, 5.5_

- [x] 7.1 ユニットテスト: Wikipedia API Client
  - API成功時のレスポンス処理を検証
  - API失敗時のエラーハンドリングを検証
  - キャッシュの動作を検証
  - _要件: 5.4, 5.5_

- [x] 8. Hover Providerの実装
  - ドキュメント内の位置からトークンを取得する機能を実装
  - 形態素情報（原形、読み、品詞）をフォーマットする機能を実装
  - Wikipedia APIクライアントを統合してサマリーを取得
  - MarkupContent形式でホバー情報を生成
  - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 8.1 プロパティテスト: ホバー情報の形態素データ
  - **プロパティ 10: ホバー情報の形態素データ**
  - **検証: 要件 5.1, 5.2, 5.3**

- [x] 8.2 プロパティテスト: Wikipedia統合
  - **プロパティ 11: Wikipedia統合**
  - **検証: 要件 5.4, 5.5**

- [x] 8.3 ユニットテスト: Hover Provider
  - トークン位置でのホバー情報生成を検証
  - トークンがない位置でのnull返却を検証
  - _要件: 5.1, 5.2, 5.3_

- [x] 9. Language Serverの実装
  - LSPサーバーのエントリーポイントを実装
  - ドキュメント同期機能を実装
  - テキスト変更時のデバウンス処理を実装（500ms）
  - 解析結果のキャッシング機能を実装（LRUキャッシュ、最大100ドキュメント）
  - 診断情報の送信機能を実装
  - セマンティックトークンプロバイダーを登録
  - ホバープロバイダーを登録
  - _要件: 1.4, 7.1, 7.3_

- [x] 9.1 プロパティテスト: テキスト更新時の再解析
  - **プロパティ 3: テキスト更新時の再解析**
  - **検証: 要件 1.4**

- [x] 9.2 プロパティテスト: 複数ファイルの独立性
  - **プロパティ 13: 複数ファイルの独立性**
  - **検証: 要件 7.3**

- [x] 9.3 ユニットテスト: Language Server
  - ドキュメント同期の動作を検証
  - キャッシュの動作を検証
  - _要件: 1.4, 7.3_

- [x] 10. Configuration Managerの実装
  - VSCode設定の読み取り機能を実装
  - 設定変更の監視機能を実装
  - デフォルト設定値を定義
  - 設定項目: mecabPath, enableGrammarCheck, enableSemanticHighlight, targetLanguages, debounceDelay
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 10.1 プロパティテスト: 設定変更の反映
  - **プロパティ 12: 設定変更の反映**
  - **検証: 要件 6.5**

- [x] 10.2 ユニットテスト: Configuration Manager
  - 設定の読み取りを検証
  - 設定変更イベントの発火を検証
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 11. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する

- [x] 12. Error Handlerの実装
  - エラーログ記録機能を実装
  - ユーザー通知機能を実装
  - リトライロジックを実装（指数バックオフ）
  - エラーコード定義を実装
  - _要件: 7.5, 8.2, 8.3_

- [x] 12.1 プロパティテスト: エラーログと通知
  - **プロパティ 14: エラーログと通知**
  - **検証: 要件 7.5**

- [x] 12.2 ユニットテスト: Error Handler
  - 各エラータイプのハンドリングを検証
  - リトライロジックを検証
  - _要件: 7.5_

- [x] 13. MeCab環境確認機能の実装
  - MeCab存在確認機能を実装
  - MeCab辞書確認機能を実装
  - MeCabバージョン確認機能を実装
  - エラーメッセージ生成機能を実装（インストール手順を含む）
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 13.1 プロパティテスト: MeCabパス検証
  - **プロパティ 15: MeCabパス検証**
  - **検証: 要件 8.5**

- [x] 13.2 ユニットテスト: MeCab環境確認
  - MeCabが見つからない場合のメッセージを検証
  - 辞書が見つからない場合のメッセージを検証
  - バージョンチェックを検証
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x] 14. VSCode Extension Clientの実装
  - 拡張機能のactivate関数を実装
  - Language Clientを初期化
  - ドキュメントセレクターを設定（対象言語の指定: C/C++/Java/Python/JS/TS/Rust/Markdown）
  - Configuration Managerを統合
  - MeCab環境確認を起動時に実行
  - deactivate関数を実装
  - _要件: 1.1, 2.1, 2.2, 2.3, 2.4, 2.5, 8.1_

- [x] 14.1 統合テスト: Extension Client
  - 拡張機能の起動と停止を検証
  - Language ClientとServerの通信を検証
  - _要件: 1.1_

- [x] 15. package.jsonの完成
  - 拡張機能のメタデータを記述
  - アクティベーションイベントを定義
  - コントリビューション（設定項目）を定義
  - セマンティックトークンの凡例を定義
  - ビルドスクリプトを定義
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 16. READMEとドキュメントの作成
  - README.mdを作成（機能説明、インストール手順、使用方法）
  - MeCabのインストール手順を記述
  - 設定項目の説明を記述
  - スクリーンショットを追加
  - _要件: 8.2, 8.3_

- [x] 17. 最終チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があればユーザーに質問する
