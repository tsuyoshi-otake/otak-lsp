# 要件定義書

## はじめに

本システムは、VSCode拡張機能として、MeCabを使用した高精度な日本語形態素解析を提供し、文法チェック、セマンティックハイライト、ホバー情報表示などの機能を実現する。プログラミング言語のコメント内に記述された日本語テキストも解析対象とし、開発者の日本語文書作成を支援する。

## 用語集

- **VSCode拡張機能**: Visual Studio Code エディタの機能を拡張するプラグイン
- **MeCab**: オープンソースの形態素解析エンジン
- **形態素**: 言語で意味を持つ最小単位
- **トークン**: 解析によって分割された文字列の単位
- **品詞**: 単語の文法的な分類（名詞、動詞、助詞など）
- **セマンティックハイライト**: 意味に基づいた構文の色分け表示
- **ホバー情報**: マウスカーソルを合わせた際に表示される追加情報
- **診断情報**: エディタ上で表示されるエラーや警告メッセージ
- **Language Server**: エディタに言語機能を提供するプロトコル実装
- **二重助詞**: 同じ助詞が連続して使用される文法エラー
- **助詞連続**: 異なる助詞が不適切に連続する文法エラー
- **動詞-助詞不整合**: 動詞と後続する助詞の組み合わせが不自然な文法エラー

## 要件

### 要件 1

**ユーザーストーリー:** 開発者として、日本語テキストを正確にトークン化したい。そうすることで、単語単位での解析や処理が可能になる。

#### 受入基準

1. WHEN ユーザーが日本語テキストを含むファイルを開く THEN システムは MeCab を使用してテキストをトークンに分割する
2. WHEN 形態素解析が実行される THEN システムは各トークンの品詞情報を取得する
3. WHEN 形態素解析が実行される THEN システムは各トークンの原形と読みを取得する
4. WHEN テキストが更新される THEN システムは変更された部分を再解析する
5. WHEN MeCab が利用できない THEN システムはユーザーに適切なエラーメッセージを表示する

### 要件 2

**ユーザーストーリー:** 開発者として、プログラミング言語のコメント内の日本語を解析したい。そうすることで、コード内のドキュメントやコメントの品質を向上できる。

#### 受入基準

1. WHEN ユーザーが C/C++/Java ファイルを開く THEN システムは `//` および `/* */` コメント内の日本語を解析する
2. WHEN ユーザーが Python ファイルを開く THEN システムは `#` および `"""` コメント内の日本語を解析する
3. WHEN ユーザーが JavaScript/TypeScript ファイルを開く THEN システムは `//` および `/* */` コメント内の日本語を解析する
4. WHEN ユーザーが Rust ファイルを開く THEN システムは `//` および `/* */` コメント内の日本語を解析する
5. WHEN ユーザーが Markdown ファイルを開く THEN システムはファイル全体の日本語を解析する
6. WHEN コメント外のコードが変更される THEN システムはコメント部分のみを再解析する

### 要件 3

**ユーザーストーリー:** 開発者として、日本語の文法エラーを自動検出したい。そうすることで、文書の品質を向上し、読みやすさを改善できる。

#### 受入基準

1. WHEN 二重助詞が検出される THEN システムは該当箇所に診断情報を表示する
2. WHEN 不適切な助詞連続が検出される THEN システムは該当箇所に診断情報を表示する
3. WHEN 動詞と助詞の不整合が検出される THEN システムは該当箇所に診断情報を表示する
4. WHEN 文法エラーが検出される THEN システムは診断情報に修正候補を含める
5. WHEN ユーザーが診断情報を確認する THEN システムはエラーの種類と説明を表示する

### 要件 4

**ユーザーストーリー:** 開発者として、品詞ごとに色分けされたテキストを見たい。そうすることで、文の構造を視覚的に理解しやすくなる。

#### 受入基準

1. WHEN 日本語テキストが表示される THEN システムは名詞を特定の色でハイライトする
2. WHEN 日本語テキストが表示される THEN システムは動詞を特定の色でハイライトする
3. WHEN 日本語テキストが表示される THEN システムは助詞を特定の色でハイライトする
4. WHEN 日本語テキストが表示される THEN システムは形容詞を特定の色でハイライトする
5. WHEN ユーザーがテーマを変更する THEN システムはテーマに適した色でハイライトを更新する

### 要件 5

**ユーザーストーリー:** 開発者として、単語の詳細情報をホバーで確認したい。そうすることで、単語の意味や用法を素早く理解できる。

#### 受入基準

1. WHEN ユーザーが単語にマウスカーソルを合わせる THEN システムは単語の原形を表示する
2. WHEN ユーザーが単語にマウスカーソルを合わせる THEN システムは単語の読みを表示する
3. WHEN ユーザーが単語にマウスカーソルを合わせる THEN システムは単語の品詞情報を表示する
4. WHEN ユーザーが単語にマウスカーソルを合わせる THEN システムは Wikipedia から取得したサマリーを表示する
5. WHEN Wikipedia API が利用できない THEN システムは形態素情報のみを表示する

### 要件 6

**ユーザーストーリー:** 開発者として、拡張機能の設定をカスタマイズしたい。そうすることで、自分の作業環境に合わせた使い方ができる。

#### 受入基準

1. WHEN ユーザーが設定画面を開く THEN システムは MeCab の実行パスを設定できる
2. WHEN ユーザーが設定画面を開く THEN システムは文法チェックの有効/無効を切り替えられる
3. WHEN ユーザーが設定画面を開く THEN システムはセマンティックハイライトの有効/無効を切り替えられる
4. WHEN ユーザーが設定画面を開く THEN システムは解析対象のファイルタイプを選択できる
5. WHEN 設定が変更される THEN システムは即座に新しい設定を適用する

### 要件 7

**ユーザーストーリー:** 開発者として、拡張機能が軽量で高速に動作してほしい。そうすることで、編集作業が中断されずスムーズに進められる。

#### 受入基準

1. WHEN テキストが編集される THEN システムは 500 ミリ秒以内に解析を開始する
2. WHEN 大きなファイルが開かれる THEN システムは段階的に解析を実行する
3. WHEN 複数のファイルが開かれている THEN システムは各ファイルを独立して解析する
4. WHEN バックグラウンドで解析が実行される THEN システムは UI のレスポンスを妨げない
5. WHEN 解析エラーが発生する THEN システムはエラーをログに記録し、ユーザーに通知する

### 要件 8

**ユーザーストーリー:** システム管理者として、MeCab が正しくインストールされているか確認したい。そうすることで、拡張機能が正常に動作することを保証できる。

#### 受入基準

1. WHEN 拡張機能が起動する THEN システムは MeCab の存在を確認する
2. WHEN MeCab が見つからない THEN システムはインストール手順を含むメッセージを表示する
3. WHEN MeCab の辞書が見つからない THEN システムは辞書のインストール手順を表示する
4. WHEN MeCab のバージョンが古い THEN システムは警告メッセージを表示する
5. WHEN ユーザーが手動で MeCab パスを設定する THEN システムは設定されたパスの有効性を検証する
